# 2048 AI 自动游戏脚本

## 项目概述

这是一个基于 Python 的 2048 游戏 AI 自动化脚本，使用 Selenium 控制浏览器在线游戏，并采用先进的 Expectimax 算法来实现智能决策。该 AI 能够自动玩 2048 游戏并达到较高分数。

## 主要特性

### 🤖 智能 AI 算法
- **Expectimax 搜索算法**：结合期望值计算和极大极小搜索
- **动态搜索深度**：根据棋盘空格数量自适应调整搜索深度
- **智能评估函数**：
  - 蛇形权重矩阵（优先保持大数字在左下角）
  - 空格奖励机制
  - 平滑度评估（相邻数字相近度）
  - 单调性考虑
- **缓存机制**：避免重复计算，提升性能

### 🎮 游戏控制
- **自动浏览器控制**：使用 Selenium WebDriver
- **实时棋盘识别**：从网页 DOM 解析游戏状态
- **自动重新开始**：游戏结束后可自动重启
- **防卡死机制**：检测游戏状态变化，避免无限循环

### 📊 可视化界面
- **实时棋盘显示**：清晰的控制台输出界面
- **分数监控**：实时显示当前分数和最大方块
- **移动记录**：显示 AI 的每一步决策

## 安装要求

### 系统要求
- Python 3.7+
- Google Chrome 浏览器
- Windows/macOS/Linux

### Python 依赖包
```bash
pip install selenium webdriver-manager
```

### 自动安装依赖
脚本会自动下载和管理 Chrome WebDriver，无需手动配置。

## 使用方法

### 基础运行
```bash
python t2048.py
```

### 配置选项

在脚本开头的配置区域可以调整以下参数：

```python
# 游戏网址
URL = "https://2048.gg/zh"

# 动画延迟（秒）
ANIMATION_DELAY = 0.05

# 等待超时时间（秒）
WAIT_TIMEOUT = 10

# 是否自动重新开始游戏
AUTO_RESTART_GAME = True
```

### AI 参数调优

```python
# 权重矩阵 - 控制 AI 的位置偏好
WEIGHT_MATRIX = [
    [ 2**4,  2**5,  2**6,  2**7 ],
    [ 2**3,  2**2,  2**1,  2**8 ],
    [ 2**0,  2**1,  2**9, 2**10 ],
    [ 2**15, 2**14, 2**12, 2**11 ]
]

# 空格权重因子
EMPTY_CELL_WEIGHT_FACTOR = 30000

# 平滑度权重
SMOOTHNESS_WEIGHT = 0.1

# 单调性权重
MONOTONICITY_WEIGHT = 1.0
```

## AI 算法详解

### 核心算法：Expectimax
1. **玩家回合（Max Node）**：选择能获得最高评估分数的移动
2. **随机回合（Chance Node）**：计算所有可能随机生成块的期望值
3. **评估函数**：综合考虑位置权重、空格数量、平滑度等因素

### 动态搜索深度
- 空格 ≥ 7：深度 2（减少计算量）
- 空格 4-6：深度 3（平衡性能）
- 空格 < 4：深度 4（精确计算）

### 评估策略
1. **位置权重**：左下角蛇形排列，大数字优先放在左下
2. **空格奖励**：保持足够的移动空间
3. **平滑度**：相邻数字差异尽量小，便于合并
4. **死局检测**：识别无法继续的状态

## 文件结构

```
2048/
├── t2048.py          # 主脚本文件
├── README.md         # 项目说明文档
└── requirements.txt  # 依赖包列表（可选）
```

## 运行示例

```
================================
|   SCORE: 1024     | MOVE: ↓ DOWN   |
================================
|  2   |  4   |  8   | 16   |
-----------------------------
|  4   |  8   | 16   | 32   |
-----------------------------
|  8   | 16   | 32   | 64   |
-----------------------------
| 16   | 32   | 64   | 128  |
-----------------------------
| MAX TILE: 128       |
================================
步数: 45
```

## 常见问题

### Q: 脚本运行时浏览器自动关闭？
A: 检查网络连接，确保能正常访问 https://2048.gg/zh

### Q: AI 运行速度太慢？
A: 可以调整以下参数：
- 减小 `ANIMATION_DELAY`
- 降低搜索深度（修改 `get_search_depth` 函数）
- 启用无头模式（取消注释 `--headless` 选项）

### Q: 程序卡死不动？
A: 脚本有防卡死机制，会自动检测并处理。如果仍有问题，可以降低 `WAIT_TIMEOUT` 值。

### Q: 想要更高的分数？
A: 可以调整以下参数：
- 增加搜索深度
- 调整权重矩阵
- 修改评估函数权重

## 性能优化建议

1. **启用无头模式**：去除浏览器界面减少资源消耗
2. **调整搜索深度**：根据硬件性能选择合适的深度
3. **缓存优化**：脚本已内置缓存机制，无需额外优化

## 技术特点

- **鲁棒性**：处理网页加载、元素定位等异常情况
- **可扩展性**：模块化设计，易于修改和扩展
- **性能优化**：缓存机制和动态深度控制
- **用户友好**：清晰的界面和详细的日志输出

## 许可证

本项目仅供学习和研究使用。请勿用于商业用途。

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

---

**注意**：本脚本需要稳定的网络连接和足够的系统资源。建议在配置较好的电脑上运行以获得最佳体验。
